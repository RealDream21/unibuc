CREATE TABLE STRADA(
    id_strada NUMBER(3) PRIMARY KEY,
    nume_strada VARCHAR(100) NOT NULL
    );
    
CREATE TABLE LOCATIE(
    id_locatie NUMBER(3) PRIMARY KEY,
    id_strada REFERENCES STRADA,
    numar NUMBER(3) NOT NULL,
    CONSTRAINT unic_nr_strada UNIQUE (id_strada, numar)
    );
    
CREATE TABLE INSTITUTIE_INVATAMANT (
    id_forma NUMBER(3) PRIMARY KEY,
    nume VARCHAR(50) NOT NULL,
    tip_forma_invatamant CHAR(40) NOT NULL,
    id_locatie NUMBER(3) REFERENCES LOCATIE (id_locatie),
    CONSTRAINT unic_nr_strada UNIQUE (id_locatie)
    );

CREATE TABLE CASA (
    id_casa NUMBER(4) PRIMARY KEY,
    camere NUMBER(2) DEFAULT 1 NOT NULL,
    dimensiune NUMBER(4) NOT NULL,
    id_locatie NUMBER(3) REFERENCES LOCATIE(id_locatie),
    CONSTRAINT unic_numar_strada UNIQUE (id_locatie)
    );

CREATE TABLE PRIMARIE (
    id_primarie NUMBER(3) PRIMARY KEY,
    nume VARCHAR(100) NOT NULL,
    id_locatie NUMBER(3) REFERENCES LOCATIE(id_locatie),
    CONSTRAINT primarie_locatie_unic UNIQUE (id_locatie)
    );

CREATE TABLE FAMILIE(
    id_familie NUMBER(4) PRIMARY KEY,
    id_primarie REFERENCES PRIMARIE,
    nume_familie VARCHAR(25) NOT NULL
    );

CREATE TABLE LOCUITOR (
    id_locuitor NUMBER(5) PRIMARY KEY,
    id_familie NUMBER(4) REFERENCES FAMILIE(id_familie),
    prenume VARCHAR(50) NOT NULL,
    sex NUMBER(1) CHECK (sex > 0 AND sex < 3)
    );

CREATE TABLE FIRMA_ORGANIZARE(
    id_firma NUMBER(3) PRIMARY KEY,
    nume VARCHAR(100) NOT NULL
    );
    
CREATE TABLE EVENIMENT_CULTURAL(
    id_eveniment NUMBER(3) PRIMARY KEY, 
    id_firma REFERENCES FIRMA_ORGANIZARE,
    nume_eveniment VARCHAR(25) NOT NULL,
    capacitate NUMBER(7) NOT NULL
    );

CREATE TABLE CUMPARATOR(
    id_cumparator NUMBER(3) PRIMARY KEY,
    nume VARCHAR(100) NOT NULL
    );

CREATE TABLE CICLU_INVATAMANT(
    id_forma_invatamant REFERENCES INSTITUTIE_INVATAMANT,
    id_locuitor REFERENCES locuitor,
    an_invatamant DATE NOT NULL,
    PRIMARY KEY (id_forma_invatamant, id_locuitor, an_invatamant)
    );
    
CREATE TABLE CONTRACT_CUMPARARE(
    id_primarie REFERENCES PRIMARIE,
    id_cumparator REFERENCES CUMPARATOR,
    id_familie REFERENCES FAMILIE,
    data_cumparare DATE NOT NULL,
    taxa NUMBER(3) DEFAULT 1,
    suma NUMBER(8) NOT NULL,
    PRIMARY KEY (id_primarie, id_cumparator, id_familie, data_cumparare)
    );

CREATE TABLE FAMILIE_CASA(
    id_familie NUMBER(4),
    id_locatie REFERENCES LOCATIE,
    data_mutare DATE NOT NULL,
    PRIMARY KEY (id_locatie, id_familie, data_mutare),
    FOREIGN KEY (id_familie) REFERENCES FAMILIE (id_familie)
);

CREATE TABLE PRIMARIE_FIRMA_ORGANIZARE(
    id_primarie REFERENCES PRIMARIE,
    id_firma REFERENCES FIRMA_ORGANIZARE,
    data_contract DATE NOT NULL,
    PRIMARY KEY (id_primarie, id_firma, data_contract)
    );

DROP TABLE CONTRACT_CUMPARARE;
DROP TABLE CUMPARATOR;
DROP TABLE PRIMARIE_FIRMA_ORGANIZARE;
DROP TABLE EVENIMENT_CULTURAL;
DROP TABLE FIRMA_ORGANIZARE;
DROP TABLE CICLU_INVATAMANT;
DROP TABLE INSTITUTIE_INVATAMANT;
DROP TABLE LOCUITOR;
DROP TABLE FAMILIE_CASA;
DROP TABLE FAMILIE;
DROP TABLE CASA;
DROP TABLE PRIMARIE;
DROP TABLE LOCATIE;
DROP TABLE STRADA;


INSERT INTO STRADA
VALUES(10, 'Teilor');
INSERT INTO STRADA
VALUES(11, 'Libertatii');
INSERT INTO STRADA
VALUES(12, 'Viilor');
INSERT INTO STRADA
VALUES(13, 'Crinului');
INSERT INTO STRADA
VALUES(14, 'Tineretului');
INSERT INTO STRADA
VALUES(15, 'Eroilor');

DROP SEQUENCE locatie_seq;
CREATE SEQUENCE locatie_seq
START with 1
INCREMENT BY 5
NOCACHE;
INSERT INTO locatie
VALUES(locatie_seq.nextval, 14, 3);
INSERT INTO LOCATIE
VALUES(locatie_seq.nextval, 14, 2);
INSERT INTO LOCATIE
VALUES(locatie_seq.nextval, 10, 1);
INSERT INTO LOCATIE
VALUES(locatie_seq.nextval, 10, 2);
INSERT INTO LOCATIE
VALUES(locatie_seq.nextval, 12, 20);
INSERT INTO LOCATIE
VALUES(locatie_seq.nextval, 15, 1);
INSERT INTO LOCATIE
VALUES(locatie_seq.nextval, 14, 4);
INSERT INTO LOCATIE
VALUES(locatie_seq.nextval, 15, 20);
INSERT INTO LOCATIE
VALUES(locatie_seq.nextval, 12, 1);
INSERT INTO LOCATIE
VALUES(locatie_seq.nextval, 13, 4);
INSERT INTO LOCATIE
VALUES(locatie_seq.nextval, 13, 5);


SELECT *
FROM locatie;
describe casa;
INSERT INTO CASA
VALUES(1, 5, 420, 1);
INSERT INTO CASA
VALUES(2, 2, 210, 31);
INSERT INTO CASA
VALUES(3, 1, 100, 11);
INSERT INTO CASA
VALUES(4, 3, 250, 21);
INSERT INTO CASA
VALUES(5, 2, 260, 26);

describe locatie;
describe strada;
SELECT l.id_locatie, s.nume_strada
FROM locatie l JOIN strada s ON l.id_strada = s.id_strada;
SELECT * from casa;
SELECT* FROM primarie;
SELECT *
FROM primarie p
WHERE p.id_locatie IN ( SELECT id_locatie
                        FROM casa);

--se vor insera primariile pe primul loc liber de pe strada aferenta
INSERT INTO PRIMARIE (id_primarie, nume, id_locatie)
SELECT 10, 'Un nume de primarie', ll.id_locatie
FROM LOCATIE ll
WHERE NOT EXISTS (
    SELECT 'x'
    FROM casa c JOIN locatie l ON c.id_locatie = l.id_locatie
    WHERE l.id_strada = ll.id_strada AND l.numar = ll.numar
);

describe primarie;

select*
from locatie;


select*
from locatie;


INSERT INTO PRIMARIE
VALUES(16, 16, 'Primaria Viilor');
INSERT INTO PRIMARIE
VALUES(15, 11, 'Primaria Tineretului');
INSERT INTO PRIMARIE
VALUES(, 13, 'Primaria Crinului');
INSERT INTO PRIMARIE
VALUES(30, 15, 12, 'Primaria Eroilor');

INSERT INTO FAMILIE
VALUES(5, 10, 'Popescu');
INSERT INTO FAMILIE
VALUES(10, 10, 'Ionescu');
INSERT INTO FAMILIE
VALUES(15, 10, 'Popa');
INSERT INTO FAMILIE
VALUES(20, 30, 'Constantinescu');
INSERT INTO FAMILIE
VALUES(25, 25, 'Lupescu');

INSERT INTO LOCUITOR 
VALUES (1, 5, 'Ion', 1);
INSERT INTO LOCUITOR
VALUES (2, 5,'Maria', 2);
INSERT INTO LOCUITOR
VALUES (3, 5, 'Ana', 2);
INSERT INTO LOCUITOR
VALUES (4, 20, 'Mihai', 1);
INSERT INTO LOCUITOR
VALUES (5, 20, 'Elena', 2);

INSERT INTO INSTITUTIE_INVATAMANT
VALUES (1, 'Scoala Gimnaziala Nr. 1', 'Scoala Gimnaziala', 10, 5);
INSERT INTO INSTITUTIE_INVATAMANT
VALUES (2, 'Liceul Teoretic "Mihai Eminescu"', 'Liceu', 11, 14);
INSERT INTO INSTITUTIE_INVATAMANT
VALUES (3, 'Scoala Gimnaziala Nr. 2', 'Scoala Gimnaziala', 14, 20);
INSERT INTO INSTITUTIE_INVATAMANT
VALUES (4, 'Colegiul National "Gheorghe Lazar"', 'Colegiu', 15, 10);
INSERT INTO INSTITUTIE_INVATAMANT
VALUES (5, 'Liceul Tehnic', 'Liceu', 12, 20);

INSERT INTO CUMPARATOR
VALUES (1, 'ABC Company');
INSERT INTO CUMPARATOR
VALUES (2, 'XYZ Corporation');
INSERT INTO CUMPARATOR
VALUES (3, '123 Industries');
INSERT INTO CUMPARATOR
VALUES (4, 'Acme Enterprises');
INSERT INTO CUMPARATOR
VALUES (5, 'Global Solutions');

INSERT INTO FIRMA_ORGANIZARE
VALUES (1, 'Event Management Company');
INSERT INTO FIRMA_ORGANIZARE
VALUES (2, 'Art Agency');
INSERT INTO FIRMA_ORGANIZARE
VALUES (3, 'Production House');
INSERT INTO FIRMA_ORGANIZARE
VALUES (4, 'Entertainment Solutions');
INSERT INTO FIRMA_ORGANIZARE
VALUES (5, 'Creative Events');

INSERT INTO EVENIMENT_CULTURAL
VALUES (1, 1, 'Concert Live', 1000);
INSERT INTO EVENIMENT_CULTURAL
VALUES (2, 5, 'Expozitie de arta', 500);
INSERT INTO EVENIMENT_CULTURAL
VALUES (3, 5, 'Teatru in aer liber', 300);
INSERT INTO EVENIMENT_CULTURAL
VALUES (4, 1, 'Dans contemporan', 800);
INSERT INTO EVENIMENT_CULTURAL
VALUES (5, 4, 'Film in aer liber', 200);

INSERT INTO CICLU_INVATAMANT
VALUES(1, 1, '15-sep-1985');
INSERT INTO CICLU_INVATAMANT
VALUES(5, 1, '20-sep-1993');
INSERT INTO CICLU_INVATAMANT
VALUES(3, 2, '15-sep-1985');
INSERT INTO CICLU_INVATAMANT
VALUES(4, 2, '20-sep-1993');
INSERT INTO CICLU_INVATAMANT
VALUES(3, 3, '29-aug-2003');
INSERT INTO CICLU_INVATAMANT
VALUES(4, 3, '30-sep-2011');
INSERT INTO CICLU_INVATAMANT
VALUES(1, 4, '29-aug-2003');
INSERT INTO CICLU_INVATAMANT
VALUES(4, 4, '30-sep-2011');
INSERT INTO CICLU_INVATAMANT
VALUES(3, 5, '11-sep-2002');
INSERT INTO CICLU_INVATAMANT
VALUES(5, 5, '19-sep-2010');

describe familie_casa;
INSERT INTO FAMILIE_CASA
VALUES(5, 14, 3, '10-may-1980');
INSERT INTO FAMILIE_CASA
VALUES(10, 14, 3, '10-april-1985');
INSERT INTO FAMILIE_CASA
VALUES(5, 14, 2, '9-april-1985');
INSERT INTO FAMILIE_CASA
VALUES(20, 10, 2, '29-aug-2003');
INSERT INTO FAMILIE_CASA
VALUES(15, 12, 20, '15-feb-1995');
INSERT INTO FAMILIE_CASA
VALUES(15, 10, 2,'20-jan-1997');
INSERT INTO FAMILIE_CASA
VALUES(10, 10, 2, '14-jan-2001');
INSERT INTO FAMILIE_CASA
VALUES(15, 10, 1, '10-june-2000'); 
INSERT INTO FAMILIE_CASA
VALUES(20, 14, 3, '19-jul-2005');
INSERT INTO FAMILIE_CASA
VALUES(20, 10, 2, '20-march-2002');
INSERT INTO FAMILIE_CASA
VALUES(10, 14, 3, '15-march-2002');

describe contract_cumparare;
INSERT INTO CONTRACT_CUMPARARE
VALUES(10, 1, 5, '15-sep-1990', 15, 120000); 
INSERT INTO CONTRACT_CUMPARARE
VALUES(10, 2, 5, '20-jan-1985', 20, 17000);
INSERT INTO CONTRACT_CUMPARARE
VALUES(30, 1, 20, '15-aug-2019', 5, 7000);
INSERT INTO CONTRACT_CUMPARARE
VALUES(25, 5, 25,'14-sep-2023', 40, 800000);
INSERT INTO CONTRACT_CUMPARARE
VALUES(30, 4, 20, '19-jul-2021', 14, 75189); 
INSERT INTO CONTRACT_CUMPARARE
VALUES(25, 2, 25, '11-june-2021', 10, 10000);
INSERT INTO CONTRACT_CUMPARARE
VALUES(10, 1, 5, '15-sep-2004', 5, 6510);
INSERT INTO CONTRACT_CUMPARARE
VALUES(30, 2, 20, '14-sep-2022', 10, 19000);
INSERT INTO CONTRACT_CUMPARARE
VALUES(25, 1, 25, '19-oct-2022', 4, 7000);
INSERT INTO CONTRACT_CUMPARARE
VALUES(10, 3, 15, '18-nov-2022', 10, 19500);
